package org.otherobjects.cms.views;import java.io.PrintWriter;import java.io.StringWriter;import java.util.List;import java.util.Map;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.web.servlet.View;import flexjson.JSONSerializer;public class JsonView implements View{    private final Logger logger = LoggerFactory.getLogger(JsonView.class);        @SuppressWarnings("unchecked")    public void render(Map map, HttpServletRequest request, HttpServletResponse response) throws Exception    {        PrintWriter output = response.getWriter();        StringWriter writer = new StringWriter();        JSONSerializer serializer = new JSONSerializer();        if (map.get("data") instanceof List)        {            writer.write(serializer.serialize(map.get("data")));        }        else if (map.containsKey("json"))        {               if(map.containsKey("jsonIncludes"))               serializer = serializer.include((String[]) map.get("jsonIncludes"));            writer.write(serializer.serialize(map.get("json")));        }        else        {            writer.write(serializer.serialize(map));        }        // FIXME Is there a more performant way of doing this        logger.debug(writer.toString());        output.write(writer.toString());    }    public String getContentType()    {        return "application/json";    }}