package org.otherobjects.cms.views;import java.io.PrintWriter;import java.util.List;import java.util.Map;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.springframework.web.servlet.View;import flexjson.JSONSerializer;public class JsonView implements View{    @SuppressWarnings("unchecked")    public void render(Map map, HttpServletRequest request, HttpServletResponse response) throws Exception    {        PrintWriter writer = response.getWriter();        JSONSerializer serializer = new JSONSerializer();        if (map.get("data") instanceof List)        {            writer.write(serializer.serialize(map.get("data")));        }        else if (map.containsKey("json"))        {               if(map.containsKey("jsonIncludes"))               serializer = serializer.include((String) map.get("jsonIncludes"));            writer.write(serializer.serialize(map.get("json")));        }        else        {            writer.write(serializer.serialize(map));        }    }    public String getContentType()    {        return "application/json";    }}