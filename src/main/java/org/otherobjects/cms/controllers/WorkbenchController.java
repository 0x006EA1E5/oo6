package org.otherobjects.cms.controllers;import java.io.IOException;import javax.servlet.ServletException;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.acegisecurity.context.SecurityContextHolder;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.util.StringUtils;import org.springframework.web.bind.ServletRequestUtils;import org.springframework.web.servlet.LocaleResolver;import org.springframework.web.servlet.ModelAndView;import org.springframework.web.servlet.mvc.Controller;public class WorkbenchController implements Controller{    protected final Logger logger = LoggerFactory.getLogger(getClass());    private LocaleResolver localeResolver;    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException    {        String newLocale = ServletRequestUtils.getStringParameter(request, "locale");        if (newLocale != null)        {            this.localeResolver.setLocale(request, response, StringUtils.parseLocaleString(newLocale));            this.logger.info("Locale set to: " + this.localeResolver.resolveLocale(request));        }        String path = request.getPathInfo();        path = path.substring(10);        if (path.equals("/"))            path = "otherobjects.resources/templates/workbench.html";        else            path = "otherobjects.resources/templates" + path;        this.logger.info("WorkbenchController: " + path);        Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();        ModelAndView view = new ModelAndView(path);        view.addObject("user", principal);        return view;    }    public void setLocaleResolver(LocaleResolver localResolver)    {        this.localeResolver = localResolver;    }}